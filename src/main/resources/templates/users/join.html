<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header.html :: head" />
<body>
<div th:replace="fragments/header.html :: header ('user')"/>
<div class="row">
    <form class="offset-4 col-4 form-group user-form" th:method="post" th:action="@{/users/join}" th:object="${userJoinRequest}" align="left">
        <div>
            <label th:for="loginId">아이디 (아이디는 변경할 수 없습니다)</label><br/>
            <div style="display: flex; gap: 10px;">
                <input type="text" th:field="*{loginId}" id="loginId" placeholder="아이디를 입력해주세요.(최대 10자)"
                       th:errorclass="error-input" style="flex: 1;"/>
                <button type="button" class="btn btn-secondary" onclick="checkDuplicateId()" style="width: fit-content;">중복 확인</button>
            </div>
            <div th:if="${#fields.hasErrors('loginId')}" th:class="error-div" th:errors="*{loginId}"/>
            <div id="idCheckMsg" style="font-size: 0.9em; margin-top: 5px;"></div>
        </div>
        <br/>
        <div>
            <label th:for="password">비밀번호</label><br/>
            <input type="password" th:field="*{password}" placeholder="비밀번호를 입력해주세요."
                   th:errorclass="error-input"/>
            <div th:class="error-div" th:errors="*{password}"/>
        </div>
        <br/>
        <div>
            <label th:for="passwordCheck">비밀번호 체크</label><br/>
            <input type="password" th:field="*{passwordCheck}" placeholder="비밀번호를 한 번 더 입력해주세요."
                   th:errorclass="error-input"/>
            <div th:class="error-div" th:errors="*{passwordCheck}"/>
        </div>
        <br/>
        <div>
            <label th:for="nickname">닉네임</label><br/>
            <input type="text" th:field="*{nickname}" placeholder="사용할 닉네임을 입력해주세요.(최대 10자)"
                   th:errorclass="error-input"/>
            <div th:class="error-div" th:errors="*{nickname}"/>
        </div>
        <br/><br/>
        <div align="center">
            <button class="btn user-btn" type="submit">회원가입</button>
        </div>
    </form>
</div>
<script th:inline="javascript">
    async function checkDuplicateId() {
    const loginId = document.getElementById('loginId').value;
    const msgArea = document.getElementById('idCheckMsg');

    if (!loginId || loginId.trim() === "") {
        alert("아이디를 먼저 입력해주세요.");
        return;
    }

    try {
        const response = await fetch(`/api/users/check-id?loginId=${loginId}`);
        const data = await response.json();

        if (data.isAvailable) {
            msgArea.innerText = "사용 가능한 아이디입니다.";
            msgArea.style.color = "blue";
        } else {
            msgArea.innerText = "이미 사용 중인 아이디입니다.";
            msgArea.style.color = "red";
        }
    } catch (error) {
        console.error("Error:", error);
        alert("통신 중 오류가 발생했습니다.");
    }
}
</script>
</body>
</html>